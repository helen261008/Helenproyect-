<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pizzería Bella Napoli</title>
</head>
<body>
    <!-- Tu contenido HTML existente -->

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Configuración de jsPDF
            const { jsPDF } = window.jspdf || {};

            // Variables globales
            const pedido = {
                nombre: '',
                fecha: '',
                hora: '',
                pizzas: [],
                extras: [],
                total: 0,
                metodoPago: '',
                cambio: 0
            };

            // Validar existencia de elementos antes de usarlos
            const getElement = (id) => document.getElementById(id);
            const validarElemento = (id) => {
                const element = getElement(id);
                if (!element) {
                    console.error(`El elemento con ID "${id}" no existe en el DOM.`);
                }
                return element;
            };

            // Navegación entre secciones
            validarElemento("comenzar")?.addEventListener("click", function() {
                cambiarSeccion("bienvenida", "formulario-seccion");
            });

            validarElemento("calcular")?.addEventListener("click", function() {
                if (!validarFormulario()) return;

                calcularPedido();
                mostrarResumen();
                cambiarSeccion("formulario-seccion", "detalle-seccion");
            });

            validarElemento("continuarPago")?.addEventListener("click", function() {
                cambiarSeccion("detalle-seccion", "pago-seccion");
            });

            validarElemento("regresarPedido")?.addEventListener("click", function() {
                cambiarSeccion("detalle-seccion", "formulario-seccion");
            });

            validarElemento("regresarResumen")?.addEventListener("click", function() {
                cambiarSeccion("pago-seccion", "detalle-seccion");
            });

            // Métodos de pago
            document.querySelectorAll('input[name="metodoPago"]').forEach(radio => {
                radio.addEventListener("change", function() {
                    const pagoEfectivo = validarElemento("pago-efectivo");
                    const pagoTarjeta = validarElemento("pago-tarjeta");

                    if (pagoEfectivo && pagoTarjeta) {
                        pagoEfectivo.classList.toggle("hidden", this.value !== "Efectivo");
                        pagoTarjeta.classList.toggle("hidden", this.value !== "Tarjeta");
                    }
                });
            });

            validarElemento("pagarEfectivo")?.addEventListener("click", function() {
                const recibidoInput = validarElemento("cantidadRecibida");
                const recibido = parseFloat(recibidoInput?.value || 0);

                if (recibido < pedido.total) {
                    alert(`El dinero recibido ($${recibido.toFixed(2)}) es menor al total ($${pedido.total.toFixed(2)}).`);
                    return;
                }

                pedido.cambio = recibido - pedido.total;
                pedido.metodoPago = "Efectivo";
                validarElemento("cambio").textContent = pedido.cambio.toFixed(2);
                mostrarTicket();
            });

            validarElemento("pagarTarjeta")?.addEventListener("click", function() {
                if (!validarTarjeta()) return;

                pedido.metodoPago = "Tarjeta";
                pedido.cambio = 0;
                mostrarTicket();
            });

            // Generar PDF
            validarElemento("descargarTicket")?.addEventListener("click", function() {
                generarPDF();
            });

            // Finalizar compra
            validarElemento("terminarCompra")?.addEventListener("click", function() {
                alert("¡Gracias por tu compra! Tu pedido está en camino.");
                reiniciarPedido();
            });

            // Funciones auxiliares
            function cambiarSeccion(ocultar, mostrar) {
                const seccionOcultar = validarElemento(ocultar);
                const seccionMostrar = validarElemento(mostrar);

                if (seccionOcultar && seccionMostrar) {
                    seccionOcultar.classList.remove("activa");
                    seccionMostrar.classList.add("activa");
                    window.scrollTo(0, 0);
                }
            }

            function validarFormulario() {
                const nombre = validarElemento("nombre")?.value.trim();
                const fecha = validarElemento("fecha")?.value;
                const hora = validarElemento("hora")?.value;
                const pizza1 = validarElemento("pizza1")?.value;

                if (!nombre) {
                    alert("Por favor, ingresa tu nombre.");
                    return false;
                }

                if (!fecha) {
                    alert("Por favor, selecciona una fecha.");
                    return false;
                }

                if (!hora) {
                    alert("Por favor, selecciona una hora.");
                    return false;
                }

                if (!pizza1 || pizza1 === "0") {
                    alert("Por favor, selecciona al menos una pizza.");
                    return false;
                }

                pedido.nombre = nombre;
                pedido.fecha = fecha;
                pedido.hora = hora;
                return true;
            }

            function calcularPedido() {
                // Implementa la lógica para calcular el total del pedido aquí
                console.log("Calculando pedido...");
            }

            function mostrarResumen() {
                // Implementa la lógica para mostrar el resumen aquí
                console.log("Mostrando resumen...");
            }

            function validarTarjeta() {
                // Implementa la validación del pago con tarjeta aquí
                console.log("Validando tarjeta...");
                return true;
            }

            function generarPDF() {
                // Implementa la lógica para generar un PDF aquí usando jsPDF
                console.log("Generando PDF...");
            }

            function mostrarTicket() {
                // Implementa la lógica para mostrar el ticket aquí
                console.log("Mostrando ticket...");
            }

            function reiniciarPedido() {
                Object.keys(pedido).forEach(key => {
                    if (Array.isArray(pedido[key])) pedido[key] = [];
                    else if (typeof pedido[key] === "number") pedido[key] = 0;
                    else pedido[key] = '';
                });
                cambiarSeccion("pago-seccion", "bienvenida");
            }
        });
    </script>
</body>
</html>
